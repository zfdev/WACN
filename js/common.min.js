var Common=function(t,n,e,a){"use strict";var i=(n.debug.log,{breakPoint:{min:{mobile:320,tablet:768,desktop:980,large:1280},max:{mobile:321,tablet:769,desktop:981,large:1281}}}),o=!1,s=!1,r=!1,c=t(e),l=t(a),u=function(){var n=function(){e.matchMedia&&(o=e.matchMedia("only screen and (max-width: "+i.breakPoint.max.tablet+"px)").matches,s=e.matchMedia("only screen and (min-width: "+i.breakPoint.min.tablet+"px) and (max-width: "+i.breakPoint.max.desktop+"px)").matches,r=e.matchMedia("only screen and (min-width: "+i.breakPoint.min.desktop+"px)").matches)},a=t.Callbacks(),l=a.add,u=function(){n()};return c.on("resize",function(){n(),a.fire()}),{add:l,init:u}}(),h=function(){var n={},e={maxHeight:520,selector:".auto-height"},a=function(n){this.o$Container=t(n),this.aChildDomArr=o(t(n)),this.bEnble=!1,this.update()};a.prototype.update=function(){if(!r)return this.reset(),void(this.bEnble=!1);this.bEnble=!0;var n=this.o$Container,e=this.aChildDomArr,a=s(e),o=i(a);n.css("height",o),t.each(e,function(){t(this).css("height",o)})},a.prototype.reset=function(){this.bEnble&&(this.o$Container.css("height","auto"),t.each(this.aChildDomArr,function(){t(this).css("height","auto")}))};var i=function(t){return Math.max.apply(null,t)},o=function(n){var e=[],a=n.data("child"),i=a.split("|");return t.each(i,function(){var a=n.find(this);a.length>1?a.each(function(){e.push(t(this))}):e.push(a)}),e},s=function(e){var a=[];return t.each(e,function(){var e=t(this).innerHeight();e>=n.maxHeight&&(e=n.maxHeight,t(this).addClass("scrollable")),a.push(e)}),a},c=function(){t.each(l,function(){this.update()})},l=[],u=function(i){n=t.extend({},e,i),t(n.selector).each(function(){var t=new a(this);l.push(t)})};return{update:c,init:u}}(),d=function(){var n=t("body"),e=function(){n.hasClass("no-scroll")||n.addClass("no-scroll")},a=function(){n.hasClass("no-scroll")&&n.removeClass("no-scroll")},i=function(){};return{noScroll:e,scroll:a,init:i}}(),f=function(){var e,a=t(".header"),i={autoHideHeight:150},o=function(){a.addClass("hide")},s=function(){a.removeClass("hide")},r=function(t){var n=c.scrollTop();t>0?n>=i.autoHideHeight&&o():s()},l=function(){e=c.scrollTop(),c.on("scroll",n.throttle(function(){var t=c.scrollTop(),n=t-e;return 0===n?!1:(r(n),void(e=t))}))};return{init:l}}(),p=function(){var n={},e={openCall:null,closeCall:null},a=t(".search-panel"),i=t(".top-nav .search .icon"),o=function(){return a.hasClass("show")?c():s(),!1},s=function(){r&&t("#searchInput").trigger("focus"),a.addClass("show"),r||i.removeClass("icon-search").addClass("icon-close"),d.noScroll(),n.openCall&&n.openCall()},c=function(){a.removeClass("show"),i.addClass("icon-search").removeClass("icon-close"),d.scroll(),n.closeCall&&n.closeCall()},u=function(){r&&c()},h=function(a){n=t.extend({},e,a),l.on("click",".search,.search-cancel a",o),l.on("blur","#searchInput",u)};return{open:s,close:c,init:h}}(),v=function(){var n={},a={beforeSearch:null,$input:t("#searchInput"),searchRequestUrl:"/searchresults/?query="},i=function(t){var n=/^\s+$/g;return n.test(t)||""===t},o=function(){var t=n.$input.val();if(!i(t)){var a=n.searchRequestUrl+encodeURIComponent(t);n.beforeSearch&&n.beforeSearch(t),e.location=a}},s=function(){c.on("keyup",function(t){"13"==t.keyCode&&o()})},r=function(e){n=t.extend({},a,e),s()};return{init:r}}(),m=function(){var e=function(){this.defaults={keywordCountLimit:10,localDataName:"searchHistory",$container:t(".search-history ul"),$clearButton:t(".search-history .clear-btn"),searchRequestUrl:"/searchresults/?query="},this.template='<li><a class="text-limit" href="<%=url%>" title="<%=keyword%>"><%=keyword%></a></li>'};e.prototype.init=function(n){this.config=t.extend({},this.defaults,n),this.bind(),this.update()},e.prototype.update=function(){this._fGetLocalKeywords(),this.render()},e.prototype.render=function(){var e="",a=this,i=this._fGetLocalKeywords();t.each(i,function(){e+=n.Template(a.template,{url:a.config.searchRequestUrl+encodeURIComponent(this),keyword:this})}),this.config.$container.empty(),this.config.$container.append(e)},e.prototype._find=function(n){var e=this._fGetLocalKeywords();return t.inArray(n,e)},e.prototype.save=function(t){if(-1==this._find(t)){var e=this._fGetLocalKeywords();e.length<this.config.keywordCountLimit?e.unshift(t):(e.pop(),e.unshift(t)),n.Storage.set(this.config.localDataName,e),this.update()}},e.prototype.clearAll=function(t){var e=t.data;return n.Storage.clear(e.config.localDataName),e.update(),!1},e.prototype.bind=function(){var t=this;l.on("click",t.config.$clearButton.selector,t,t.clearAll)},e.prototype._fGetLocalKeywords=function(){return n.Storage.get(this.config.localDataName)||[]};var a=new e,i=function(){a.init()},o=function(t){a.save(t)};return{save:o,init:i}}(),C=function(){var e={},a={$container:t(".search-panel .hot-tag"),requestUrl:"/hotkeywords",requestParam:"topK",keywordsCount:9,searchUrl:"/searchresults/?query=",template:'<div class="col-xs-6 col-sm-4"><a class="btn btn-link btn-block btn-default text-limit" href="<%=url%>" title="<%=keyword%>"><%=keyword%></a></div>'},i=function(a){var i="";return t.each(a,function(){var t=this,a=e.searchUrl+encodeURIComponent(t);i+=n.Template(e.template,{url:a,keyword:t})}),i},o=function(t){e.$container.empty(),e.$container.append(t)},s=function(){var n={};n[e.requestParam]=e.keywordsCount,t.ajax({url:e.requestUrl,method:"POST",data:n,dataType:"json"}).done(function(t){o(i(t))})},r=function(n){e=t.extend({},a,n),s()};return{init:r}}(),g=function(){var n=t(".nav"),a=t(".nav > ul > li > a"),i=n.find(".panel-wrapper"),o=function(){return n.hasClass("show")?u():s(),!1},s=function(){n.addClass("show"),p.close(),d.noScroll(),t(".nav-toggle>.icon").removeClass("icon-navigation").addClass("icon-close")},c=function(){n.removeClass("show"),a.removeClass("active"),t(".nav-toggle>.icon").addClass("icon-navigation").removeClass("icon-close")},u=function(){c(),d.scroll()},h=function(){return 0==!t(this).next(".panel-wrapper").length?(a.removeClass("active"),t(this).addClass("active"),i.removeClass("show"),t(this).next(".panel-wrapper").addClass("show"),d.noScroll(),!1):void 0},f=function(){r&&(a.removeClass("active"),i.removeClass("show"),u(),d.scroll())},v=function(){i.find("dl").each(function(){var n=t(this),e=n.find("dt").length;e%2&&n.addClass("odd-child"),m(n)})},m=function(){i.find(".menu-child").each(function(){var n=t(this);n.on("mousewheel",function(n){if(t(this).hasClass("scrollable")){var e=n.originalEvent,a=e.wheelDelta||-e.detail;this.scrollTop+=30*(0>a?1:-1),n.preventDefault()}})})},C=function(){t(this).prev("dt").toggleClass("mouse-hover")},g=function(){var n=t(this).prev("dt").find("a").attr("href");return e.location=n,!1},b=function(){l.on("click",".nav-toggle",o),l.on("click",".nav > ul > li > a",h),l.on("click",".content",f),l.on("mouseover",".nav .panel-content dl dd",C),l.on("mouseout",".nav .panel-content dl dd",C),l.on("click",".nav .panel-content dl dd",g),v(),m()};return{hide:c,open:s,close:u,init:b}}(),b=function(){var n={},e={showClass:"show-sm show-xs"},a=function(e){var a=t(e.data).find(".menu-title"),i=t(e.data).find(".menu-child"),o=t(this);if(o.hasClass("expand")){if("desktop"==t(e.data).data("tab")&&r)return!1;o.removeClass("expand"),o.next(".menu-child").removeClass(n.showClass)}else a.removeClass("expand"),o.addClass("expand"),i.removeClass(n.showClass),o.next(".menu-child").addClass(n.showClass);return!1},i=function(t){t.on("click.accordian",".menu-title",t,a),o(t)},o=function(e){e.find(".menu-title").each(function(){t(this).hasClass("expand")&&t(this).next(".menu-child").addClass(n.showClass)})},s=function(a){n=t.extend({},e,a),t(".accordian-menu").each(function(){i(t(this)),o(t(this))})};return{init:s}}(),w=function(){var n=function(n){this.o$Container=t(n),this.update()};n.prototype.update=function(){if(!r){var n=t(e).height(),a=0,i=this.o$Container;"string"==typeof i.data("top")&&(a=t("."+i.data("top")).height()),"number"==typeof i.data("top")&&(a=i.data("top"));var o=0;i.children().each(function(){o+=t(this).height()});var s=n-a;o+a>n?(i.addClass("scroll-y"),i.innerHeight(s)):(i.removeClass("scroll-y"),i.css("height","auto"),i.data("fullscreen")&&i.css("height",s))}};var a=[],i=function(){t.each(a,function(){this.update()})},o=function(){t(".auto-scroll").each(function(){var t=new n(this);a.push(t)})};return{update:i,init:o}}(),y=function(){var n=function(n){t(n).on("click.panel",".panel-title .icon-close",function(){return t(this).parents(".panel-wrapper").removeClass("show"),d.scroll(),!1})},e=function(){t(".panel-wrapper").each(function(){n(this)})};return{init:e}}(),k=function(){var n={},e={$tabNav:t(".tab-nav")},a=function(t){this.$tabNavContainer=t};a.prototype.init=function(){this._bind()},a.prototype._bind=function(){var n=this;n.$tabNavContainer.find('[data-toggle="tab"]').each(function(){t(this).parent("li").hasClass("active")&&i(t(this))}),n.$tabNavContainer.on("click.tab",'[data-toggle="tab"]',n,o)};var i=function(n){var e=n.attr("href"),a=/^#\S+/g;a.test(e)&&(t(e).parents(".tab-content").find(".tab-panel").removeClass("show-md"),t(e).addClass("show-md"))},o=function(n){n.data.$tabNavContainer.find("li").removeClass("active"),t(this).parent("li").addClass("active"),i(t(this))},s=function(i){n=t.extend({},e,i),n.$tabNav.each(function(){var n=new a(t(this));n.init()})};return{init:s}}(),x=function(){var t=function(){r||FastClick.attach(a.body)};return{init:t}}();return{init:function(){u.init(),f.init(),d.init(),p.init({openCall:g.hide}),g.init(),w.init(),b.init(),y.init(),h.init(),m.init(),C.init(),v.init({beforeSearch:function(t){m.save(t)}}),k.init(),u.add(w.update),u.add(h.update),x.init()}}}(jQuery,AUI,window,document);$(function(){Common.init()});